function UpdraftCentral_Updates(){function e(e,t,a,r){var n=UpdraftCentral.storage_get("wporg_api_"+e+"_"+t,600);if(n&&n.hasOwnProperty("name"))return void r.call(this,n,a);var s=D;"theme"==e&&(s=I),jQuery.getJSON(s,{action:e+"_information",request:{slug:t}},function(n,s){"success"==s&&(UpdraftCentral.storage_set("wporg_api_"+e+"_"+t,n,!0),r.call(this,n,a))})}function t(t,a,r,n){for(var s=0,i=a.length;s<i;s++){var d=a[s];if(d&&d.hasOwnProperty("update")&&d.update.hasOwnProperty("package")&&d.update["package"]){var o=d.update["package"];if("string"!=typeof o)continue;var u=o.match(/^https?:\/\/((downloads|www)\.)?wordpress\.org\//);u&&("plugin"==r?e(r,d.update.slug,d,function(e,a){if(e&&e.hasOwnProperty("sections")){var r=t.find('.updraftcentral_row_extracontents .updates-plugin-update.updates-update[data-plugin-file="'+a.update.plugin+'"]');L&&"undefined"!=typeof n&&(r=n.find('.row.update-item[data-plugin-file="'+a.update.plugin+'"][data-website_id="'+t.data("site_id")+'"]'));var s=r.data("plugin-info");if(!s)return;s.update.hasOwnProperty("sections")&&s.update.sections||(s.update.sections={}),e.sections.hasOwnProperty("changelog")&&(s.update.sections.changelog=e.sections.changelog),e.sections.hasOwnProperty("description")&&(s.update.sections.description=e.sections.description),r.attr("data-plugin-info",JSON.stringify(s))}}):"theme"==r&&e(r,d.update.theme,d,function(e,a){if(e&&e.hasOwnProperty("sections")){var r=t.find('.updraftcentral_row_extracontents .updates-theme-update.updates-update[data-theme="'+a.update.theme+'"]');L&&"undefined"!=typeof n&&(r=n.find('.row.update-item[data-theme="'+a.update.theme+'"][data-website_id="'+t.data("site_id")+'"]'));var s=r.data("theme-info");if(!s)return;e.sections.hasOwnProperty("changelog")&&(s.update.hasOwnProperty("sections")&&s.update.sections||(s.update.sections={}),s.update.sections.changelog=e.sections.changelog),r.attr("data-theme-info",JSON.stringify(s))}}))}}}function a(e){var t=jQuery.Deferred(),a=setInterval(function(){jQuery.trim(e.html()).length<1&&(clearInterval(a),t.resolve(!0))},1e3);return setTimeout(function(){clearInterval(a),t.reject(!1)},1e4),t.promise()}function r(e,t,r,n){var s=t.data("site_id"),i=Q.item(s);A>0&&(console.log("UpdraftCentral: update error (follows)"),console.log(e)),r.find(".update-go").show(),r.find(".update-in-progress").hide();var d=i.site_description,o=i.site_url;d==o&&(d="");var u="";e.hasOwnProperty("messages")&&jQuery(e.messages).each(function(e,t){u+=t+"\n"}),A>0&&("unable_to_connect_to_filesystem"==e.error?console.log("UpdraftCentral: unable_to_connect_to_filesystem: filesystem credentials apparently wrong; will clear"):console.log("UpdraftCentral: update failed: will clear filesystem credentials in case they were wrong")),i.update_processing=!1,i.site_credentials=!1,Q.update(s,i);var p;e.hasOwnProperty("error_message")&&""!=e.error_message?p=e.error_message:udclion.updates.update_error_messages.hasOwnProperty(e.error)?p=udclion.updates.update_error_messages[e.error]:(p=udclion.updates.update_error_messages.update_failed,"update_failed"!=e.error&&(p+=" ("+e.error+")"));var l=jQuery("#updraftcentral_notice_container"),c=jQuery('#updraftcentral_notice_container > .updraftcentral_notice[data-site_id="'+s+'"]:first');a(l).then(function(){c=UpdraftCentral.add_dashboard_notice(UpdraftCentral.template_replace("updates-update-error-container",{site_url:o,site_description:d}),"error",!1,{site_id:s})}).always(function(){c.find(".update-errors").append(UpdraftCentral.template_replace("updates-update-error",{error_message:p,error:e.error,messages:u,entity_info:n,entity:e}))})}function n(e){e.updates.plugin.clear(),e.updates.theme.clear(),e.updates.core.clear(),jQuery(".updraftcentral_row_extracontents button.update-go").each(function(){var t=jQuery(this).closest(".row.update-item"),a=t.data("entity"),r=t.data("name"),n=t.data(a+"-info");if(("core"===a||n&&n.hasOwnProperty("update"))&&("core"!==a||n&&n.hasOwnProperty("version"))){var s=!0;if(n.hasOwnProperty("installed")&&n.installed.hasOwnProperty("is_mysql")&&!n.installed.is_mysql&&(s=!1),n.hasOwnProperty("sufficient")){var i=!s||n.sufficient.mysql,d=n.sufficient.php;i?d||(mysql_error="<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_php,n.version,n.php_version,n.installed.php)):d?mysql_error="<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_mysql,n.version,n.mysql_version,n.installed.mysql):mysql_error="<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_php_and_mysql,n.version,n.php_version,n.mysql_version,n.installed.php,n.installed.mysql)}if("undefined"==typeof r||!r||!r.length)switch(a){case"plugin":case"theme":r=n.update[a];break;case"core":r=udclion.updates.wordpress}if("undefined"!=typeof r&&r&&r.length){var o={},u=!1;switch(a){case"plugin":o.plugin=n.update.plugin,o.slug=n.update.slug,o.label=n.name,o.name=r,o.old_version=n.version,o.new_version=n.update.new_version,o.plugin&&o.plugin.length&&o.slug&&o.slug.length||(u=!0);break;case"theme":o.theme=n.update.theme,o.label=n.name,o.name=r,o.old_version=n.version,o.new_version=n.update.new_version,o.theme&&o.theme.length||(u=!0);break;case"core":"undefined"!=typeof mysql_error&&(o.mysql_error=mysql_error),o.core=n.version,o.label=r,o.name=r,o.old_version=n.installed.version,o.new_version=n.version,o.core&&o.core.length||(u=!0)}if(!u&&o&&o.hasOwnProperty("name")&&o.name){var p=UpdraftCentral_Library.md5(e.id+"_"+o.name);o.entity=a,e.updates[a].add(p,o)}else A>0&&(console.log("UpdraftCentral: load_site_updates(): update ("+a+") without expected info (details follow)"),console.log(o))}}}),C.load_credentials(e).then(function(t){var a=t.request_filesystem_credentials,r=!1;for(var n in a)a[n]&&(r=!0);e.credentials_required=r,Q.update(e.id,e),A>0&&console.log("UpdraftCentral: remote site credentials has been loaded")})}function s(e,t){P?t.set_custom_status(udclion.updates.backup_currently_running_for+" "+e.site_description):t.set_custom_status(udclion.updates.backup_currently_running);var a=e.hasOwnProperty("autobackup_requested")&&e.autobackup_requested;if(a){var r=e.hasOwnProperty("autobackup_complete")&&e.autobackup_complete;r?A>0&&console.log("UpdraftCentral: automatic pre-upgrade backup was already requested, and is complete"):A>0&&console.log("UpdraftCentral: automatic pre-upgrade backup was already requested, but is not yet complete")}else{A>0&&console.log("UpdraftCentral: automatic pre-upgrade backup indicated - will request"),e.autobackup_requested=!0,e.autobackup_complete=!1,Q.update(e.id,e);var n="";e.updates.plugin.count()&&(n="plugins"),e.updates.theme.count()&&(n=n?n+",themes":"themes"),e.updates.core.count()&&(n=n?n+",wpcore":"wpcore"),extra_data={_listener_title:"<h2>"+e.site_description+" - "+udclion.updates.automatic_backup+"</h2>"},UpdraftCentral.set_current_site_row(e.site_row),UpdraftCentral_Module_UpdraftPlus.backupnow_go(!1,!1,!1,n,extra_data,udclion.updates.automatic_backup)}}function i(e,t,a){var r=jQuery.Deferred();return t.additional_options={progress_bar:a.progress,update_info:e,items_count:a.tasks_count()},d(t).then(function(e){r.resolve(e)}).fail(function(e){r.reject(e)}),r.promise()}function d(e){var t=jQuery.Deferred(),a=e.additional_options.progress_bar,r=e.additional_options.update_info;return P?a.set_current_label(r.name+" ("+e.site_description+")"):a.set_current_label(r.name),!e.site_credentials&&e.credentials_required?C.get_credentials(e).then(function(a){e.site_credentials=a.site_credentials,e.save_credentials_in_browser=a.save_credentials_in_browser,d(e).then(function(e){t.resolve(e)}).fail(function(a){P?t.resolve({skip:!0,response:udclion.failed_credentials,site:e.site_description}):t.reject(a)})}).fail(function(a){t.resolve({skip:!0,response:udclion.failed_credentials,site:e.site_description})}):(a.start(),o(e,r).then(function(e){a.update(),t.resolve(e)}).fail(function(n){a.update(),t.resolve({skip:!0,item:!0,response:r,site:e.site_description})})),t.promise()}function o(e,t){var a=jQuery.Deferred(),n=e.site_row,s={},i=jQuery("#updates_container div.updraftcentral_table > .tbody"),d=e.additional_options.items_count,o=90,u=400,p=d*o;switch(p>u&&(p=u),"undefined"!=typeof t.mysql_error&&delete t.mysql_error,t.entity){case"plugin":s.plugins=[{plugin:t.plugin,slug:t.slug}];break;case"theme":s.themes=[{theme:t.theme}];break;case"core":s.core=[{core:t.core}],p+=5*o}return e.site_credentials&&(s.meta={filesystem_credentials:e.site_credentials}),UpdraftCentral.send_site_rpc("updates.do_updates",s,n,function(t,d,o){if("ok"==d&&t){var u=!1,p=!1;jQuery(t.data.plugins).each(function(t,a){var s=a.plugin,d=n.find('.updraft_updates_output .updates-plugin-update[data-plugin-file="'+s+'"]');P&&(d=i.find('.row.update-item.updates-plugin-update[data-plugin-file="'+s+'"][data-website_id="'+e.id+'"]'));var o=d.data("plugin-info");a.hasOwnProperty("error")?(p=!0,r(a,n,d,o)):(u=!0,A>0&&a.hasOwnProperty("messages")&&console.log(a.messages),d.slideUp("slow",function(){d.remove()}))}),jQuery(t.data.themes).each(function(t,a){var s=a.theme,d=n.find('.updraft_updates_output .updates-theme-update[data-theme="'+s+'"]');P&&(d=i.find('.row.update-item.updates-theme-update[data-theme="'+s+'"][data-website_id="'+e.id+'"]'));var o=d.data("theme-info");a.hasOwnProperty("error")?(p=!0,r(a,n,d,o)):(u=!0,A>0&&a.hasOwnProperty("messages")&&console.log(a.messages),d.slideUp("slow",function(){d.remove()}))}),jQuery(t.data.core).each(function(t,a){var s=n.find(".updraft_updates_output .updates-core-update");P&&(s=i.find('.row.update-item.updates-core-update[data-website_id="'+e.id+'"]'));var d=s.data("core-info");d.name=udclion.updates.wordpress,a.hasOwnProperty("error")?(p=!0,r(a,n,s,d)):(u=!0,A>0&&a.hasOwnProperty("messages")&&console.log(a.messages),s.slideUp("slow",function(){s.remove()}))}),u&&!p&&e.save_credentials_in_browser&&UpdraftCentral.storage_set("filesystem_credentials_"+e.site_hash,e.site_credentials,!0),p?a.reject(t):a.resolve(t)}else{var l=[];s.hasOwnProperty("plugins")&&jQuery(s.plugins).each(function(t,a){var s=a.plugin,d=n.find('.updraft_updates_output .updates-plugin-update[data-plugin-file="'+s+'"]');P&&(d=i.find('.row.update-item.updates-plugin-update[data-plugin-file="'+s+'"][data-website_id="'+e.id+'"]'));var o=d.data("plugin-info");a.error="update_failed",r(a,n,d,o),l.push({entity_info:o,error:a.error})}),s.hasOwnProperty("themes")&&jQuery(s.themes).each(function(t,a){var s=a.theme,d=n.find('.updraft_updates_output .updates-theme-update[data-theme="'+s+'"]');P&&(d=i.find('.row.update-item.updates-theme-update[data-theme="'+s+'"][data-website_id="'+e.id+'"]'));var o=d.data("theme-info");a.error="update_failed",r(a,n,d,o),l.push({entity_info:o,error:a.error})}),s.hasOwnProperty("core")&&jQuery(s.core).each(function(t,a){var s=n.find(".updraft_updates_output .updates-core-update");P&&(s=i.find('.row.update-item.updates-core-update[data-website_id="'+e.id+'"]'));var d=s.data("core-info");d.name=udclion.updates.wordpress,a.error="update_failed",r(a,n,s,d),l.push({entity_info:d,error:a.error})}),a.reject(l)}},null,p),a.promise()}function u(e,t){var a=jQuery(".updraftcentral_row_extracontents button#btn-update-all");l(a,e,t)}function p(e,t){var a=jQuery(".updraftcentral_row_extracontents button#btn-mass-update");l(a,e,t)}function l(e,t,a){var r,n,s=t.tasks_count();"undefined"!=typeof a&&a?(e.addClass("disabled"),n=udclion.updates.updates_in_progress):(s>0?e.removeClass("disabled"):e.addClass("disabled"),r=1==s?udclion.updates.queued_update:udclion.updates.queued_updates,n='<span class="dashicons dashicons-controls-play"></span> '+udclion.updates.process+" "+r+" ("+s+")"),e.html(n)}function c(e,t){var a=U.item(e.id);"undefined"!=typeof a&&("undefined"!=typeof t&&a.progress.abort(t),a.clear_tasks(),U.update(e.id,a),x.clear(),e.update_processing=!1,"undefined"!=typeof Q&&Q.update(e.id,e),u(a),jQuery(".updraftcentral_row_extracontents button.update-go").removeClass("disabled").show(),jQuery(".updraftcentral_row_extracontents button.update-in-progress").removeClass("disabled").hide(),setTimeout(function(){a.progress.reset()},2e3))}function _(e,t){var a=jQuery.Deferred();e.updates.plugin.clear(),e.updates.theme.clear(),e.updates.core.clear();var r=jQuery("<table/>",{style:"display:none;"}).html(t);return r.find(".row.update-item").each(function(){var t=jQuery(this),a=t.data("entity"),r=t.data("name"),n=t.data(a+"-info");if(("core"===a||n&&n.hasOwnProperty("update"))&&("core"!==a||n&&n.hasOwnProperty("version"))){var s=!0;if(n.hasOwnProperty("installed")&&n.installed.hasOwnProperty("is_mysql")&&!n.installed.is_mysql&&(s=!1),n.hasOwnProperty("sufficient")){var i=!s||n.sufficient.mysql,d=n.sufficient.php;i?d||(mysql_error="<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_php,n.version,n.php_version,n.installed.php)):d?mysql_error="<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_mysql,n.version,n.mysql_version,n.installed.mysql):mysql_error="<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_php_and_mysql,n.version,n.php_version,n.mysql_version,n.installed.php,n.installed.mysql)}if("undefined"==typeof r||!r||!r.length)switch(a){case"plugin":case"theme":r=n.update[a];break;case"core":r=udclion.updates.wordpress}if("undefined"!=typeof r&&r&&r.length){var o={},u=!1;switch(a){case"plugin":o.plugin=n.update.plugin,o.slug=n.update.slug,o.label=n.name,o.name=r,o.old_version=n.version,o.new_version=n.update.new_version,o.plugin&&o.plugin.length&&o.slug&&o.slug.length||(u=!0);break;case"theme":o.theme=n.update.theme,o.label=n.name,o.name=r,o.old_version=n.version,o.new_version=n.update.new_version,o.theme&&o.theme.length||(u=!0);break;case"core":"undefined"!=typeof mysql_error&&(o.mysql_error=mysql_error),o.core=n.version,o.label=r,o.name=r,o.old_version=n.installed.version,o.new_version=n.version,o.core&&o.core.length||(u=!0)}if(!u&&o&&o.hasOwnProperty("name")&&o.name){var p=UpdraftCentral_Library.md5(e.id+"_"+o.name);o.entity=a,e.updates[a].add(p,o)}else A>0&&(console.log("UpdraftCentral: preload_site_updates_credentials(): update ("+a+") without expected info (details follow)"),console.log(o))}}}),C.load_credentials(e).then(function(t){var r=t.request_filesystem_credentials,n=!1;for(var s in r)r[s]&&(n=!0);e.credentials_required=n,Q.update(e.id,e),A>0&&console.log("UpdraftCentral: remote site credentials has been loaded"),a.resolve({site:e,response:t})}).fail(function(e){a.reject(e)}),a.promise()}function f(e,a,r){var n=jQuery.Deferred(),s=r.progress,i={force_refresh:!1};return jQuery(this).hasClass("updraftcentral_updates_force_check")&&(i.force_refresh=!0),s.set_current_label(udclion.updates.loading_updates_from+' "'+e.data("site_description")+'"...',!0),s.start(),UpdraftCentral.send_site_rpc("updates.get_updates",i,e,function(r,i,d){if("ok"!=i||!r||"updates"!=UpdraftCentral.get_dashboard_mode())return n.resolve({skip:!0,response:"undefined"!=typeof r.error?r.error:r,site:e.data("site_description")}),!0;var o=e.data("site_id"),u=new UpdraftCentral_Site(e);Q.exists(o)&&(u=Q.item(o));var p="",l={plugins:null,themes:null,core:null};if(r.data&&(r.data.hasOwnProperty("plugins")&&r.data.plugins.length&&(l.plugins=UpdraftCentral.template_replace("updates-plugin-mass-updates",{plugins:r.data.plugins,website:u.site_description,website_id:u.id,host_url:u.site_url}),p+=l.plugins),r.data.hasOwnProperty("themes")&&r.data.themes.length&&(l.themes=UpdraftCentral.template_replace("updates-theme-mass-updates",{themes:r.data.themes,website:u.site_description,website_id:u.id,host_url:u.site_url}),p+=l.themes),r.data.hasOwnProperty("core")&&r.data.core.length&&(l.core=UpdraftCentral.template_replace("updates-core-mass-updates",{core:r.data.core,website:u.site_description,website_id:u.id,host_url:u.site_url}),p+=l.core),r.data.hasOwnProperty("meta")&&"undefined"!=typeof r.data.meta.automatic_backups&&(u.automatic_backups=r.data.meta.automatic_backups)),l.plugins||l.themes||l.core){var c=a.find(".updraft_updates_output"),f=jQuery("<option/>",{value:u.site_description});p=UpdraftCentral_Library.sanitize_html(p),f.html(u.site_description),Q.exists(o)||Q.add(u.id,u),_(u,p).then(function(i){s.update(),a.find("div.updraftcentral_table").is(":visible")||a.find("div.updraftcentral_table").show(),a.find("div.updraftcentral_table > .tbody").append(p),a.find('div.updraftcentral_table > .tbody input[name="uc_updates_check_item"]').attr("disabled",!0);var d=jQuery("div.updates_table_container.mass_updates"),o=d.find('.row.update-item[data-entity="plugin"]:visible').length,u=d.find('.row.update-item[data-entity="theme"]:visible').length,l=d.find('.row.update-item[data-entity="core"]:visible').length;d.find(".filter-elements span.filter_plugin_count").html(o),d.find(".filter-elements span.filter_theme_count").html(u),d.find(".filter-elements span.filter_core_count").html(l),"undefined"!=typeof r.data&&("undefined"!=typeof r.data.plugins&&r.data.plugins.length&&t(e,r.data.plugins,"plugin",a.find("div.updraftcentral_table > .tbody")),"undefined"!=typeof r.data.themes&&r.data.themes.length&&t(e,r.data.themes,"theme",a.find("div.updraftcentral_table > .tbody"))),n.resolve({output:p,output_container:c,response:i,skip:!1})}).fail(function(t){n.resolve({skip:!0,response:t,site:e.data("site_description")})})}else n.resolve({skip:!0,response:udclion.updates.no_updates,site:e.data("site_description")})},null,90),n.promise()}function h(){var e=jQuery('#updates_container select[name="uc_updates_sort"]').val(),t=e.match(/^(.*)_(asc|desc)$/);if(null!==t){var a=t[1],r=t[2],n=jQuery("#updates_container div.updraftcentral_table > .tbody"),s=n.find(".row.update-item");s.sort(function(e,t){var n=jQuery(e).data(a).toString().toLowerCase(),s=jQuery(t).data(a).toString().toLowerCase();return"desc"===r?s<n?-1:s>n?1:0:n<s?-1:n>s?1:0}),n.html(s)}}function m(){var e=jQuery('#updates_container input[name="uc_updates_filter_keyword"]').val().toLowerCase(),t=(jQuery("#updates_container div.updraftcentral_table"),[]);if(jQuery(".row.update-item").hide(),jQuery("#updates_container .filter-elements input.uc_updates_filter_type:checked").each(function(){var e=jQuery(this);t.push(e.val())}),t.length)for(var a=0;a<t.length;a++){var r=t[a];"undefined"!=typeof website&&website.length?jQuery('.row.update-item[data-entity="'+r+'"][data-website="'+website+'"]').show():jQuery('.row.update-item[data-entity="'+r+'"]').show()}e.length>0&&jQuery(".row.update-item").each(function(){var t=jQuery(this);if("undefined"!=typeof t&&t.is(":visible")){var a=t.data("entity")||"",r=t.data("name")||"",n=t.data("website")||"",s=t.data("installed_version")||"",i=t.data("new_version")||"";a.toLowerCase().indexOf(e)!==-1||r.toLowerCase().indexOf(e)!==-1||n.toLowerCase().indexOf(e)!==-1||s.toString().indexOf(e)!==-1||i.toString().indexOf(e)!==-1?t.show():t.hide()}})}function g(){var e=jQuery("#updates_container div.updraftcentral_table"),t=jQuery("#updates_container div.updraftcentral_table > .tbody"),a=e.find("span.uc_updates_paginator");if(a.length){var r=parseInt(x.item("current_page")),n=parseInt(x.item("items_per_page")),s=x.item("sorted_items")||[],i=parseInt(s.length/n),d=parseInt(s.length%n),o=d>0?i+1:i,u=(r-1)*n,p=r*n,l=s.slice(u,p);if(l.length){jQuery(".row.update-item").hide();for(var c=0;c<l.length;c++){var _=l[c],f=_.data("name"),h=_.data("website");jQuery('.row.update-item[data-name="'+f+'"][data-website="'+h+'"]').show()}}var m=jQuery("<a/>",{id:"load_previous",href:"javascript://"}).html(udclion.updates.previous),g=jQuery("<a/>",{id:"load_next",href:"javascript://"}).html(udclion.updates.next);if(r>1&&l.length?m.removeClass("disabled"):m.addClass("disabled"),r<o&&l.length?g.removeClass("disabled"):g.addClass("disabled"),a.html(jQuery("<div/>").append(m.clone()).html()+" | "+jQuery("<div/>").append(g.clone()).html()),o>1?a.show():a.hide(),jQuery(".row.update-item:visible").length>0)P||e.find('input[name="uc_updates_check_all"]').removeAttr("disabled"),t.find("div#no_matching_items").remove();else if(0==e.find("div#no_matching_items").length){P||e.find('input[name="uc_updates_check_all"]').attr("disabled",!0);var v=jQuery('<div id="no_matching_items" class="row"><div class="col-md-12">'+udclion.updates.no_matching_items+"</div></div>");t.append(v)}}}function v(){var e=parseInt(x.item("current_page"));x.update("current_page",e+1),g()}function y(){var e=parseInt(x.item("current_page"));x.update("current_page",e-1),g()}function b(){m(),h();var e=jQuery("#updraftcentral_dashboard_existingsites #updates_container"),t=e.find("div.updraftcentral_table > .tbody"),a=jQuery("div.updates_table_container.mass_updates"),r=0,n=0,s=0,i=[];t.find("div.updates-update").each(function(){var e=jQuery(this);if(e.is(":visible")){var t=e.data("entity");"plugin"===t&&r++,"theme"===t&&n++,"core"===t&&s++,i.push(e)}}),x.exists("sorted_items")?x.update("sorted_items",i):x.add("sorted_items",i),x.update("current_page",1),g(),w(),a.find(".filter-elements span.filter_plugin_count").html(r),a.find(".filter-elements span.filter_theme_count").html(n),a.find(".filter-elements span.filter_core_count").html(s)}function w(){var e=0;q.clear_tasks(),O.clear();for(var t=x.exists("sorted_items")?x.item("sorted_items"):[],a=0;a<t.length;a++){var r=t[a],n=r.find('input[name="uc_updates_check_item"]'),s=r.data("website_id"),d=Q.item(s);if("undefined"!=typeof d&&n.is(":checked")){var o=r.data("entity"),u=r.data("name");if("undefined"!=typeof u&&u.length){var l=UpdraftCentral_Library.md5(d.id+"_"+u),c=d.get_update_info(o,l);if(c){var _=q.add_task(i,[c,d]);_?(A>0&&(console.log("Item queued for processing:"),console.log(c)),d.automatic_backups&&!d.autobackup_complete&&(O.exists(d.id)||O.add(d.id,d)),e++):n.removeAttr("checked")}else n.removeAttr("checked")}else n.removeAttr("checked")}}p(q),e>0?jQuery("#updates_container button#btn-mass-update").removeClass("disabled"):jQuery("#updates_container button#btn-mass-update").addClass("disabled")}function k(e,t){if("undefined"!=typeof e.site_runner){"undefined"!=typeof t&&e.site_runner.progress.abort(t),e.site_runner.clear_tasks();var a=1,r=50;x.exists("current_page")?x.update("current_page",a):x.add("current_page",a),x.exists("items_per_page")?x.update("items_per_page",r):x.add("items_per_page",r),L=!1,e.container.find("button#btn-reload-updates").removeClass("disabled"),"undefined"==typeof e.has_non_skipped_items||e.has_non_skipped_items?(e.form_container.find("input, select").removeAttr("disabled"),e.container.find('div.updraftcentral_table > .tbody input[name="uc_updates_check_item"]').each(function(){var e=jQuery(this),t=e.data("unavailable");"undefined"!=typeof t&&t?e.prop("disabled",!0):e.prop("disabled",!1)}),b(),setTimeout(function(){e.site_runner.progress.reset()},2e3)):(e.container.find("div.updraftcentral_table > .thead").hide(),e.site_runner.progress.reset())}}function j(e,t){if(0===O.count())A>0&&console.log("UpdraftCentral_Updates: process_site_backup - All sites backup has been processed. Proceeding to mass updates now."),t.set_custom_status(udclion.updates.backup_done),setTimeout(function(){e.trigger("click")},2e3);else{var a=O.get_items();if(a.length){var r=a[0];r.autobackup_options={caller:j,mass_updates:!0,args:[e,t]},s(r,t)}}}var C,Q,U,x,q,O,P,L,T=".updraftcentral_row_extracontents",D="https://api.wordpress.org/plugins/info/1.1/",I="https://api.wordpress.org/themes/info/1.1/",A=UpdraftCentral.get_debug_level(),S=function(){C=new UpdraftCentral_Credentials,Q=new UpdraftCentral_Collection,U=new UpdraftCentral_Collection,x=new UpdraftCentral_Collection,q=new UpdraftCentral_Tasks_Runner({concurrency:1}),O=new UpdraftCentral_Collection,P=!1,L=!1};S();var M=function(){jQuery("#updraftcentral_modal ul#updates-sections-list li:first").addClass("selected")};jQuery("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set_updates",function(){UpdraftCentral.register_event_handler("click","#updates_container div.updraftcentral_table span.uc_updates_paginator a#load_previous",function(){jQuery(this).hasClass("disabled")||y()}),UpdraftCentral.register_event_handler("click","#updates_container div.updraftcentral_table span.uc_updates_paginator a#load_next",function(){jQuery(this).hasClass("disabled")||v()}),UpdraftCentral.register_event_handler("change",'#updates_container select[name="uc_updates_sort"], #updates_container input.uc_updates_filter_type, #updates_container select[name="uc_updates_filter_website"]',function(){b()}),UpdraftCentral.register_event_handler("keyup",'#updates_container input[name="uc_updates_filter_keyword"]',function(){b()}),UpdraftCentral.register_event_handler("click","#updates_container button#btn-mass-update",function(){if(!jQuery(this).hasClass("disabled")||0===O.count()&&q.tasks_count()&&!L){var e=jQuery(this),t=jQuery("div.updates_table_container.mass_updates");A>0&&console.log("Mass updates execution started..."),P=!0,p(q,!0),jQuery("div.updates_table_container.mass_updates").find("input, select, button#btn-reload-updates").attr("disabled",!0);var a=t.find("div.progress-section div.progress-bar");q.progress.set_container(a),O.count()>0?j(e,q.progress):q.process_tasks().then(function(e){A>0&&console.log("Mass updates execution has been completed!");for(var a,r="<h2>"+udclion.updates.error_items_header+" ("+udclion.updates.skipped+")</h2>",n=[],s=0;s<e.length;s++)if(a=e[s],"undefined"!=typeof a.skip&&a.skip)if("undefined"!=typeof a.item&&a.item){var i=a.response;n.push({label:i.label,version:i.old_version,site:a.site})}else UpdraftCentral.add_dashboard_notice_singleton(r+a.response+" - "+a.site,"error",3e4,{},"errors");if(n.length){for(var s=0;s<n.length;s++){var d=n[s];r+="<div>"+sprintf("%s (%s) - %s.",d.label,d.version,d.site)+"</div>"}UpdraftCentral.add_dashboard_notice_singleton(r,"error",3e4,{},"error_items")}q.progress.set_complete(),q.clear_tasks(),p(q),t.find("input, select, button#btn-reload-updates").each(function(){var e=jQuery(this),t=e.data("unavailable");"undefined"!=typeof t&&t?e.prop("disabled",!0):e.prop("disabled",!1)}),P=!1,jQuery('#updates_container input[name="uc_updates_check_all"]').removeAttr("checked"),jQuery('#updates_container input[name="uc_updates_check_item"]').removeAttr("checked"),setTimeout(function(){q.progress.reset(),b();var e=t.find("div.updraftcentral_table > .tbody");e.find("div.updates-update").length<1&&(t.find("div.updraftcentral_table > .thead").hide(),e.find("div#no_matching_items").length>0&&e.find("div#no_matching_items").remove(),e.append('<div class="row"><div class="col-md-12"><h5>'+udclion.updates.no_available_updates+"</h5></div></div>"))},3e3)}).fail(function(e){A>0&&(console.log("Mass updates execution has stopped due to the following error(s):"),console.log(e)),q.progress.abort(udclion.updates.process_aborted),q.clear_tasks(),p(q),jQuery("div.updates_table_container.mass_updates").find("input, select, button#btn-reload-updates").each(function(){var e=jQuery(this),t=e.data("unavailable");"undefined"!=typeof t&&t?e.prop("disabled",!0):e.prop("disabled",!1)}),P=!1,jQuery('#updates_container input[name="uc_updates_check_all"]').removeAttr("checked"),jQuery('#updates_container input[name="uc_updates_check_item"]').removeAttr("checked"),b(),setTimeout(function(){q.progress.reset()},2e3)})}}),UpdraftCentral.register_event_handler("click","#updates_container #btn-reload-updates",function(){jQuery(this).hasClass("disabled")||jQuery(document).find("button.updraftcentral_action_show_all_updates").trigger("click")}),UpdraftCentral.register_event_handler("change",'#updates_container input[name="uc_updates_check_all"]',function(){var e=!1;jQuery(this).is(":checked")&&(e=!0),jQuery('#updates_container input[name="uc_updates_check_item"]').each(function(){jQuery(this).prop("checked",e)}),w()}),UpdraftCentral.register_event_handler("change",'#updates_container input[name="uc_updates_check_item"]',function(){w()}),UpdraftCentral.register_event_handler("click",".updraftcentral_row_extracontents button.update-info",function(){var e=jQuery(this).closest(".row.update-item"),t=e.data("entity"),a=e.data(t+"-info");return a?void UpdraftCentral.open_modal(udclion.updates.update_info,UpdraftCentral.template_replace("updates-"+t+"-update-info",a),!0,!1,M):void(A>0&&console.log(UpdraftCentral_Library.ucfirst(t)+" info not found"))}),UpdraftCentral.register_event_handler("click","#updraftcentral_updraftplus_actions > button.updraftcentral_action_show_all_updates",function(){jQuery("#updraftcentral_sites_search_area, #updraftcentral_dashboard_existingsites .updraftcentral_site_row, #updraftcentral_dashboard_existingsites .updraftcentral_row_divider").hide();var e=jQuery("#updraftcentral_dashboard_existingsites"),t=e.find("#updates_container");0===t.length&&(t=jQuery("<div/>",{id:"updates_container","class":"updraftcentral_row_extracontents"}),e.append(t));var a=UpdraftCentral.template_replace("updates-table-mass-header",{});t.html('<div class="updraft_updates_output updraft_module_output">'+a+"</div>"),x.clear(),q.clear_tasks(),e.find(".updraftcentral_site_row").each(function(){var e=jQuery(this);q.add_task(f,[e,t])}),t.find("button#btn-reload-updates").addClass("disabled");var r=t.find("div.updates_table_container.mass_updates");r.find("input, select").attr("disabled",!0),L=!0,q.progress.set_container(r.find("div.progress-section div.progress-bar")),q.process_tasks().then(function(e){A>0&&console.log("Tasks execution has been completed!");for(var a,n=!1,s=0;s<e.length;s++)a=e[s],"undefined"==typeof a.skip||a.skip?A>0&&"undefined"!=typeof a.site&&(console.log(a.site+" has been skipped due to the following reason or error:"),console.log(a)):n=!0;n||(t.find("div.updraftcentral_table").is(":visible")||t.find("div.updraftcentral_table").show(),t.find("div.updraftcentral_table > .tbody").append('<div class="row"><div class="col-md-12"><h5>'+udclion.updates.no_available_updates+"</h5></div></div>")),q.progress.set_complete(udclion.updates.loading_process_completed),k({site_runner:q,container:t,form_container:r,has_non_skipped_items:n})}).fail(function(e){A>0&&(console.log("Tasks execution has stopped due to the following error(s):"),console.log(e)),k({site_runner:q,container:t,form_container:r},udclion.updates.abort)})}),UpdraftCentral.register_modal_listener("ul#updates-sections-list a.updates-section-link",function(e){e.preventDefault();var t=jQuery(this).data("section");jQuery("#updraftcentral_modal #updates-sections-list li.selected").removeClass("selected"),jQuery(this).closest("li").addClass("selected"),jQuery("#updraftcentral_modal .updates-section").hide(),jQuery("#updraftcentral_modal #updates-section-"+t).show()}),UpdraftCentral.register_modal_listener(".request-filesystem-credentials-dialog-content #ssh",function(){jQuery("#updraftcentral_modal .request-filesystem-credentials-dialog-content #ssh_keys").show()}),UpdraftCentral.register_modal_listener(".request-filesystem-credentials-dialog-content #ftp, .request-filesystem-credentials-dialog-content #ftps",function(){jQuery("#updraftcentral_modal .request-filesystem-credentials-dialog-content #ssh_keys").hide()}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents button#btn-update-all",function(e){var t=Q.item(e.data("site_id")),a=U.item(t.id);if(!jQuery(this).hasClass("disabled")||t.autobackup_complete&&!t.update_processing&&a.tasks_count()){var r=jQuery(this);if(A>0&&console.log("Task runner execution started..."),u(a,!0),jQuery(".updraftcentral_row_extracontents button.update-go").addClass("disabled"),jQuery(".updraftcentral_row_extracontents button.update-in-progress").addClass("disabled"),a.progress.set_container(jQuery(this).parent()),t.automatic_backups&&!t.autobackup_complete)t.autobackup_options={caller:r,bypass:!1},s(t,a.progress);else{var n=0;t.autobackup_complete&&t.autobackup_options.hasOwnProperty("bypass")&&!t.autobackup_options.bypass&&(a.progress.set_custom_status(udclion.updates.backup_done),t.autobackup_options.bypass=!0,n=2e3),
setTimeout(function(){t.update_processing=!0,Q.update(t.id,t),a.process_tasks().then(function(r){A>0&&console.log("Tasks execution has been completed!");for(var n,s="<h2>"+udclion.updates.error_items_header+" ("+udclion.updates.skipped+")</h2>",i=[],d=0;d<r.length;d++)if(n=r[d],"undefined"!=typeof n.skip&&n.skip)if("undefined"!=typeof n.item&&n.item){var o=n.response;i.push({label:o.label,version:o.old_version,site:n.site})}else UpdraftCentral.add_dashboard_notice_singleton(s+n.response+" - "+n.site,"error",3e4,{},"errors");if(i.length){for(var d=0;d<i.length;d++){var u=i[d];s+="<div>"+sprintf("%s (%s) - %s.",u.label,u.version,u.site)+"</div>"}UpdraftCentral.add_dashboard_notice_singleton(s,"error",3e4,{},"error_items")}a.progress.set_complete(),c(t),setTimeout(function(){var t=e.find(".updates_table_container .tbody");t.children().length<1&&(t.closest(".updates_table_container").remove(),e.find(".updraft_updates_output").append("<h5>"+udclion.updates.no_updates+"</h5>"))},3e3)}).fail(function(e){A>0&&(console.log("Tasks execution has stopped due to the following error(s):"),console.log(e)),c(t,udclion.updates.process_aborted)})},n)}}}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents button.update-go",function(e){if(!jQuery(this).hasClass("disabled")){var t=Q.item(e.data("site_id")),a=U.item(t.id),r=jQuery(this).closest(".row.update-item"),n=r.data("entity"),s=r.data("name");if("undefined"==typeof s)switch(n){case"plugin":case"theme":var d=r.data(n+"-info");s=d.update[n];break;case"core":s=udclion.updates.wordpress}if("undefined"!=typeof t&&"undefined"!=typeof s&&s.length){var o=UpdraftCentral_Library.md5(t.id+"_"+s),p=t.get_update_info(n,o);if(p)if("undefined"!=typeof p.mysql_error)UpdraftCentral_Library.dialog.alert(p.mysql_error,null,!1);else{var l=a.add_task(i,[p,t]);if(l){U.update(t.id,a),A>0&&(console.log("Item queued for processing:"),console.log(p));var c=r.find("button.update-go");c.hide(),r.find(".update-in-progress").css("width","auto").show(),x.add(o,l),u(a)}}}}}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents button.update-in-progress",function(e){if(!jQuery(this).hasClass("disabled")){var t=Q.item(e.data("site_id")),a=U.item(t.id),r=jQuery(this).closest(".row.update-item"),n=r.data("entity"),s=r.data("name");if("undefined"==typeof s)switch(n){case"plugin":case"theme":var i=r.data(n+"-info");s=i.update[n];break;case"core":s=udclion.updates.wordpress}if("undefined"!=typeof t&&"undefined"!=typeof s&&s.length){var d=UpdraftCentral_Library.md5(t.id+"_"+s);if(x.exists(d)){var o=x.item(d);if(a.remove_task(o)){var p=r.find("button.update-in-progress");p.hide(),r.find(".update-go").css("width","auto").show(),x.remove(d),u(a)}}}}}),UpdraftCentral.register_row_clicker(".updraftcentral_action_show_updates",function(e){var a={force_refresh:!1};jQuery(this).hasClass("updraftcentral_updates_force_check")&&(a.force_refresh=!0),UpdraftCentral.send_site_rpc("updates.get_updates",a,e,function(a,r,s){if("ok"==r&&a&&"updates"==UpdraftCentral.get_dashboard_mode()){var i=e.data("site_id"),d=new UpdraftCentral_Site(e);if(Q.exists(i)&&(d=Q.item(i)),U.exists(d.id)){var o=U.item(d.id);o.clear_tasks(),U.update(d.id,o)}else U.add(d.id,new UpdraftCentral_Tasks_Runner({concurrency:1}));var u=e.find(".updraftcentral_row_extracontents"),p="",l={plugins:null,themes:null,core:null};a.data&&(a.data.hasOwnProperty("plugins")&&a.data.plugins.length&&(l.plugins=UpdraftCentral.template_replace("updates-plugin-updates",{plugins:a.data.plugins})),a.data.hasOwnProperty("themes")&&a.data.themes.length&&(l.themes=UpdraftCentral.template_replace("updates-theme-updates",{themes:a.data.themes})),a.data.hasOwnProperty("core")&&a.data.core.length&&(l.core=UpdraftCentral.template_replace("updates-core-updates",{core:a.data.core})),a.data.hasOwnProperty("meta")&&"undefined"!=typeof a.data.meta.automatic_backups&&(d.automatic_backups=a.data.meta.automatic_backups)),p=l.plugins||l.themes||l.core?UpdraftCentral.template_replace("updates-table-header",l):"<h5>"+udclion.updates.no_updates+"</h5>",u.html('<div class="updraft_updates_output updraft_module_output"><div class="dashicons dashicons-image-rotate updraftcentral_action_show_updates updraftcentral_updates_force_check"></div>'+UpdraftCentral_Library.sanitize_html(p)+"</div>"),a.data.plugins.length&&t(e,a.data.plugins,"plugin"),a.data.themes.length&&t(e,a.data.themes,"theme"),Q.exists(i)||Q.add(d.id,d),n(d)}})},!0),jQuery("#updraftcentral_notice_container").on("click",".updraftcentral_notice .update-failure-messages-show",function(e){e.preventDefault(),jQuery(this).hide().siblings(".update-failure-messages-text").slideDown()}),jQuery("#updraftcentral_notice_container").on("click",".updraftcentral_notice > .updraftcentral_notice_dismiss",function(){var e=jQuery(this).closest("#updraftcentral_notice_container"),t=e.find(".update-errors");if(jQuery.trim(t.html()).length>1){var a=$site_row.data("site_id"),r=Q.item(a);r.update_processing=!1,Q.update(r.id,r)}}),jQuery("#updraftcentral_dashboard_existingsites").on("updraftcentral_listener_finished_updraftplus_backup",function(e,t){e.preventDefault();var a=t.site_id,r=Q.item(a);if("undefined"!=typeof r&&!r.autobackup_complete&&(A>0&&console.log("UpdraftCentral: automatic backup is complete."),r.autobackup_complete=!0,Q.update(r.id,r),"undefined"!=typeof r.autobackup_options.caller)){var n=r.autobackup_options.caller;"undefined"!=typeof r.autobackup_options.mass_updates&&r.autobackup_options.mass_updates?(O.exists(r.id)&&O.remove(r.id),n.apply(null,r.autobackup_options.args)):n.trigger("click")}}),jQuery("#updraftcentral_dashboard_existingsites_container").on("click",".updraftcentral_site_row "+T+" .updates-update a",function(e){var t=jQuery(this).attr("href");if("undefined"!=typeof t&&"http"==t.substring(0,4)){e.preventDefault();var a=window.open(t,"_blank");a.focus()}})})}jQuery(document).ready(function(){new UpdraftCentral_Updates});