jQuery(document).ready(function(t){function e(e,a){var d=n(e).split("&"),r={};t.each(d,function(t,e){var n=e.split("="),a=decodeURIComponent(n[0]);if(a.indexOf("option_page")>=0||a.indexOf("_wpnonce")>=0||a.indexOf("_wp_http_referer")>=0)return!0;if(a.indexOf("[")>=0){var d=a.match(/\[(.*)\]/).pop();a=a.substring(0,a.indexOf("[")),d&&"0"!==d?("undefined"==typeof r[a]&&(r[a]={}),r[a][d]=decodeURIComponent(n[1])):("undefined"==typeof r[a]&&(r[a]=[]),r[a].push(decodeURIComponent(n[1])))}else r[a]=decodeURIComponent(n[1])});var s=new Date;d=JSON.stringify({version:"1.12.19",epoch_date:s.getTime(),local_date:s.toLocaleString(),network_site_url:a.data("site_url"),data:r}),t("body").append('<div id="udc_exported_settings" style="display:none;">'+d+"</div>"),UpdraftCentral_Library.download_inner_html("updraftplus-settings.json","udc_exported_settings","text/json"),t("#udc_exported_settings").remove()}function n(e){t("body").append('<div class="hidden_udp_settings" style="display:none;">'+e+"</div>");var n=t(".hidden_udp_settings input[name!='action'], .hidden_udp_settings textarea, .hidden_udp_settings select").serialize();return t.each(t(".hidden_udp_settings input[type=checkbox]").filter(function(e){return 0==t(this).prop("checked")}),function(e,a){var d="0";n+="&"+t(a).attr("name")+"="+d}),t(".hidden_udp_settings").remove(),n}function a(t){var e=decodeURIComponent(t);e=JSON.parse(e),UpdraftCentral_Library.dialog.confirm(udclion.advancedtools.importing_data_from+" "+e.network_site_url+"\n"+udclion.advancedtools.exported_on+" "+e.local_date+"\n"+udclion.advancedtools.continue_import,function(t){t&&(e=e.data,UpdraftCentral.send_site_rpc("updraftplus.save_settings",e,$site_row,function(t,e,n){"ok"===e?message=udclion.advancedtools.import_success:message=udclion.advancedtools.import_failed,UpdraftCentral.open_modal(udclion.advancedtools.import_settings,"<p>"+message+"</p>",null,!1,null,!0)}))})}t("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set_advancedtools",function(){function n(e){t('.expertmode .advanced_settings_container .advanced_tools:not(".'+e+'")').hide(),t(".expertmode .advanced_settings_container .advanced_tools."+e).fadeIn("slow"),t(".expertmode .advanced_settings_container .advanced_tools_button:not(#"+e+")").removeClass("active"),t(".expertmode .advanced_settings_container .advanced_tools_button#"+e).addClass("active")}UpdraftCentral.register_row_clicker(".updraftcentral_site_advanced_settings",function(t){UpdraftCentral.send_site_rpc("updraftplus.get_advanced_settings",{suppress_plugins_for_debugging:!0},t,function(e,n,a){"ok"===n&&t.find(".updraftcentral_row_extracontents").empty().append(UpdraftCentral_Library.sanitize_html(e.data))})},!0),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_menu .advanced_tools_button",function(t){n(this.id)}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraftplus-phpinfo",function(e,n){UpdraftCentral.send_site_rpc("core.phpinfo",null,e,function(e,n,a){if("ok"==n&&e.data){var d="";t.each(e.data,function(e,n){d+="<h3>"+e+"</h3>\n<table>\n",t.each(n,function(e,n){n.constructor===Array?d+="<tr><td>"+e+"</td><td>"+n[0]+"</td><td>"+n[1]+"</td></tr>\n":"string"==typeof n?d+=t.isNumeric(e)?"<tr><td></td><td>"+n+"</td></tr>\n":"<tr><td>"+e+"</td><td>"+n+"</td></tr>\n":(console.log("UpdraftCentral: phpinfo: Unrecognised output for key "+e+" (follows)"),console.log(n))}),d+="</table>\n"}),UpdraftCentral.open_modal(udclion.advancedtools.php_info,'<div id="updraftcentral_phpinfo_results">'+d+"</div>",null,!1,null,!0,"modal-lg")}},t(this))}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraftplus_httpget_go",function(e,n){data=t("#updraftplus_httpget_uri").val(),UpdraftCentral.send_site_rpc("updraftplus.http_get",data,e,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.response,"<p>"+UpdraftCentral_Library.sanitize_html(t.data.response)+"</p>",null,!1,null,!0)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraftplus_httpget_gocurl",function(e,n){var a=t("#updraftplus_httpget_uri").val();UpdraftCentral.send_site_rpc("updraftplus.http_get_curl",a,e,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.response,"<p><pre>"+UpdraftCentral_Library.sanitize_html(t.data.response)+"</pre></p>",null,!1,null,!0,"modal-lg")})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraftplus_callwpaction_go",function(e,n){var a={wpaction:t("#updraftplus_callwpaction").val()};UpdraftCentral.send_site_rpc("core.call_wordpress_action",a,e,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.response,"<p>"+UpdraftCentral_Library.sanitize_html(t.data.response)+"</p>",null,!1,null,!0)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraft_reset_sid",function(e,n){UpdraftCentral.send_site_rpc("updraftplus.reset_site_id",null,e,function(e,n,a){t("#updraft_show_sid").text(e.data)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraftplus-rawbackuphistory",function(t,e){UpdraftCentral.send_site_rpc("updraftplus.show_raw_backup_and_file_list",null,t,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.raw_backup_history,'<pre><div id="raw_backup_modal">'+UpdraftCentral_Library.sanitize_html(t.data)+"</div></pre>",null,!1,null,!0,"modal-lg")})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .lock_admin .change_lock_settings",function(e,n){var a={old_password:t("#updraft_unlockadmin_oldpassword").val(),password:t("#updraft_unlockadmin_password").val(),session_length:t("#updraft_unlockadmin_session_length").val(),support_url:t("#updraft_unlockadmin_support_url").val()};UpdraftCentral.send_site_rpc("updraftplus.change_lock_settings",a,e,function(e,n,d){t("#updraft_unlockadmin_oldpassword").val(a.password),""==a.password?message=udclion.advancedtools.settings_unlocked:message=udclion.advancedtools.password_changed_to+" '"+a.password+"' ",UpdraftCentral.open_modal(udclion.advancedtools.lock_changed,"<p>"+message+"</p>",null,!1,null,!0)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .updraft_central .updraft_debugrow .updraftcentral_key_delete",function(e,n){var a=t(this).data("key_id");UpdraftCentral.send_site_rpc("updraftplus.delete_key",a,e,function(t,n,a){var d=e.find("#updraftcentral_keys");d.replaceWith(t.data.keys_table)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .updraft_central #updraftcentral_view_log",function(t,e){UpdraftCentral.send_site_rpc("updraftplus.fetch_log",null,t,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.log,"<pre>"+UpdraftCentral_Library.sanitize_html(t.data.log_contents)+"</pre>",function(){},!1,null,!1,"modal-lg")})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .search_replace #search_replace_form .search_and_replace",function(t,e){var n={search:t.find("#search").val(),replace:t.find("#replace").val(),pagesize:t.find("#pagesize").val(),whichtables:t.find("#whichtables").val(),show_return_link:!1,show_heading:!1};UpdraftCentral.send_site_rpc("updraftplus.search_replace",n,t,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.response,"<h2>"+udclion.advancedtools.search_replace+"</h2><pre>"+UpdraftCentral_Library.sanitize_html(t.data.log)+"</pre>",null,!1,null,!0)})}),UpdraftCentral.register_modal_listener(".return_to_updraft",function(t){t.preventDefault(),UpdraftCentral.close_modal()}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .total_size .count",function(e){var n=t(this).data("type");jQuery("#updraft_diskspaceused_"+n).html("<em>"+udclion.advancedtools.calculating+"</em>");var a=t(this).closest(".updraftcentral_site_row");UpdraftCentral.send_site_rpc("core.count",n,a,function(t,e,a){jQuery("#updraft_diskspaceused_"+n).html(t.data)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content #updraftplus-settings-export",function(t,n){UpdraftCentral.send_site_rpc("updraftplus.get_settings",{include_database_decrypter:0,include_adverts:0,include_save_button:1},t,function(n,a,d){var r=UpdraftCentral_Library.sanitize_html(n.data.settings);e(r,t)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content #updraftplus-settings-import",function(t,e){var n=document.getElementById("import_settings");if(0==n.files.length)return void UpdraftCentral_Library.dialog.alert(udclion.advancedtools.import_select_file);var d=n.files[0],r=new FileReader;r.onload=function(){a(this.result)},r.readAsText(d)}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .updraft_wipe_settings",function(t,e){UpdraftCentral.send_site_rpc("updraftplus.wipe_settings",null,t,function(t,e,n){1==t.data?message=udclion.advancedtools.settings_wiped:message=udclion.advancedtools.wipe_settings_error,UpdraftCentral.open_modal(udclion.advancedtools.wipe_settings,"<p>"+message+"</p>",null,!1,null,!0)})})})});