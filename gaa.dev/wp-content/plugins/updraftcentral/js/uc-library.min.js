function UpdraftCentral_Task_Progress(){var e,t,n,r,a,o=this,i=i||"";this.total_items,this.label;var s=function(){if(0==i.length)return void console.log("UpdraftCentral_Task_Progress: Progress bar container not defined - exiting");if("undefined"==typeof jQuery.ui||"function"!=typeof jQuery.ui.progressbar)return void console.log("UpdraftCentral_Task_Progress: jQuery progressbar or one of its dependency is not installed - exiting");var r=i.find("#uc_task_progress");if(0===r.length&&i.append('<div id="uc_task_progress"><div id="uc_task_progress_label">'+udclion.current_progress+': 0%</div><div id="uc_task_progress_bar"><div id="uc_task_progress_status"></div></div></div>'),e=i.find("#uc_task_progress > div#uc_task_progress_bar"),e.is(":ui-progressbar")){var s=parseInt(o.total_items),c=100%s,l=t.count()*parseInt(100/s)+c;l<100&&(a=l,e.progressbar("option","value",l))}else e.progressbar({max:100,value:0,change:function(){i.find("#uc_task_progress_label").text(udclion.current_progress+": "+e.progressbar("option","value")+"%")},complete:function(){clearInterval(n)}})},c=function(){return"undefined"==typeof i?void console.log("UpdraftCentral_Task_Progress: A container element is required. This is where the progress bar is to be appended - exiting"):(o.total_items=0,t=new UpdraftCentral_Collection,r=0,void(a=0))};c();var l=function(){var s=i.find("#uc_task_progress");if(0!=s.length){var c=parseInt(o.total_items),l=100%c;r=t.count()*parseInt(100/c)+l,n=setInterval(function(){a<r&&a<99?e.progressbar("option","value",++a):clearInterval(n)},1e3)}};this.set_custom_status=function(e){var t=i.find("#uc_task_progress_status");0!=t.length&&"undefined"!=typeof e&&e&&t.text(e)},this.set_complete=function(t){var n=i.find("#uc_task_progress_status");0!=n.length&&(a=100,e.progressbar("option","value",a),"undefined"!=typeof t?n.text(t):n.text(udclion.process_completed))},this.update=function(){t.count()&&s()},this.set_current_label=function(e,n){var r=i.find("#uc_task_progress_status");0!=r.length&&t.add(e,e)&&(o.label=e,"undefined"!=typeof n&&n?r.text(e):r.text(udclion.processing+' "'+o.label+'" ...'))},this.set_container=function(e){"undefined"!=typeof n&&clearInterval(n),i=e,s()},this.start=function(){l()},this.end=function(){o.reset()},this.abort=function(e){var t=i.find("#uc_task_progress_status");0!=t.length&&(clearInterval(n),"undefined"!=typeof e?t.text(e):t.text(udclion.process_aborted))},this.reset=function(){var e=i.find("#uc_task_progress");0!=e.length&&(clearInterval(n),total_items=0,t.clear(),r=0,a=0,e.remove())},this.clear=function(){clearInterval(n),total_items=0,t.clear(),r=0,a=0},this.hide=function(){var e=i.find("#uc_task_progress");0!=e.length&&e.hide()},this.show=function(){var e=i.find("#uc_task_progress");0!=e.length&&e.show()}}function UpdraftCentral_Collection(){var e=this,t=0,n={};this.add=function(r,a){return!e.exists(r)&&(n[r]=a,t++,!0)},this.update=function(t,r){return!!e.exists(t)&&(n[t]=r,!0)},this.remove=function(r){return!!e.exists(r)&&(delete n[r],t--,!0)},this.item=function(e){return n[e]},this.keys=function(){var e=[];for(var t in n)e.push(t);return e},this.exists=function(e){return"undefined"!=typeof n[e]},this.clear=function(){t=0,n={}},this.count=function(){return t},this.get_items=function(){var e=[];for(var t in n)e.push(n[t]);return e}}function UpdraftCentral_Tasks_Runner(e){var t,n=this,e=e||{};this.progress;var r=function(){t=new UpdraftCentral_Collection,n.progress=new UpdraftCentral_Task_Progress};r();var a=function(e,t){e.func.apply(null,e.args).then(function(e){t(null,e)}).fail(function(e){var n=e;"undefined"==typeof n&&(n=!0),t(n)})};this.tasks_count=function(){return t.count()},this.remove_task=function(e){return t.remove(e)},this.add_task=function(e,r){if("function"==typeof e){var a=(new Date).getTime(),o=Math.ceil(1e3*Math.random()),i=UpdraftCentral_Library.md5("_key_"+a+o),s={func:e,args:r};if(s.args.push(n),t.add(i,s))return i}return!1},this.clear_tasks=function(){n.progress.clear(),t.clear()},this.abort=function(){queue.abort(),n.clear_tasks()},this.process_tasks=function(){var r=jQuery.Deferred();if(t.count()>0){n.progress.total_items=t.count();var o;o="undefined"!=typeof e.concurrency?d3.queue(e.concurrency):d3.queue();for(var i=t.keys(),s=0;s<i.length;s++){var c=t.item(i[s]);o.defer(a,c)}o.awaitAll(function(e,t){e?r.reject(e):r.resolve(t)})}else r.reject(udclion.tasks_queue_empty);return r.promise()}}function UpdraftCentral_Credentials(){var e,t,n,r=function(){e=new UpdraftCentral_Collection,t=jQuery("#updraftcentral_modal_dialog"),n="hidden.bs.modal"};r(),this.get_credentials=function(r){var a=jQuery.Deferred(),i=r.site_row,s=r.id;if(e.exists(s)){var c,l=e.item(s),d=l.request_filesystem_credentials||{},u=!1;for(var _ in d)d[_]&&(u=!0,c=_);if("undefined"==typeof l.site_credentials)if(u){var p=UpdraftCentral.storage_get("filesystem_credentials_"+r.site_hash),f=UpdraftCentral.get_site_heading(i);UpdraftCentral.open_modal(udclion.updates.connection_information,UpdraftCentral.template_replace("updates-request-credentials",{credentials_form:l.filesystem_form,site_heading:f}),function(){var e=jQuery("#updraftcentral_modal #filesystem-credentials-save-in-browser").is(":checked"),s=jQuery("#updraftcentral_modal .request-filesystem-credentials-dialog-content input").serialize();o(i,c,s).then(function(t){l.site_credentials=s,r.site_credentials=s,e&&(r.save_credentials_in_browser=!0),a.resolve(r)}).fail(function(e,t,n){UpdraftCentral_Library.dialog.alert("<h2>"+udclion.failed_credentials_heading+"</h2><p>"+udclion.failed_credentials+"</p>"),a.reject(e,t,n)}).always(function(){t.off(n),UpdraftCentral.close_modal()})},udclion.updates.update,function(){jQuery('#updraftcentral_modal .request-filesystem-credentials-dialog-content input[value=""]:first').focus(),p&&(saved_credentials=UpdraftCentral_Library.unserialize(p),saved_credentials&&(jQuery.each(saved_credentials,function(e,t){var n=jQuery('#updraftcentral_modal .request-filesystem-credentials-dialog-content input[name="'+e+'"]').attr("type");"text"==n||"number"==n||"password"==n?jQuery('#updraftcentral_modal .request-filesystem-credentials-dialog-content input[name="'+e+'"]').val(t):"checkbox"==n?t?jQuery('#updraftcentral_modal .request-filesystem-credentials-dialog-content input[name="'+e+'"]').prop("checked",!0):jQuery('#updraftcentral_modal .request-filesystem-credentials-dialog-content input[name="'+e+'"]').prop("false",!0):"radio"==n?jQuery('#updraftcentral_modal .request-filesystem-credentials-dialog-content input[name="'+e+'"][value="'+t+'"]').prop("checked",!0):n&&console.log("UpdraftCentral: unrecognised field type in credential form: type="+n+", field index="+e)}),jQuery("#updraftcentral_modal #filesystem-credentials-save-in-browser").prop("checked",!0))),jQuery('#updraftcentral_modal div#request-filesystem-credentials-form fieldset > legend:contains("Connection Type"):gt(0)').hide(),t.on(n,function(){a.reject()})},!0,"",function(){a.reject()})}else a.reject(r);else r.site_credentials=l.site_credentials,a.resolve(r)}else a.reject(r);return a.promise()},this.load_credentials=function(t){var n=jQuery.Deferred(),r=t.id,o=t.site_row;return"undefined"!=typeof r?e.exists(r)?n.resolve(e.item(r)):a(o).then(function(t){e.add(r,t),n.resolve(t)}).fail(function(e,t,r){n.reject(e,t,r)}):n.reject(),n.promise()},this.load_all_credentials=function(t){var n=jQuery.Deferred(),r=[];if("undefined"!=typeof t&&t.length>0){for(var o=0;o<t.length;o++){var i=t[o],s=i.site_row;r.push(a(s).then(function(t){var n=i.id;"undefined"!=typeof n&&e.add(n,t)}))}jQuery.when.apply(jQuery,r).then(function(){n.resolve()})}return n.promise()};var a=function(e){var t=jQuery.Deferred();return UpdraftCentral.send_site_rpc("core.get_credentials",null,e,function(e,n,r){return"ok"===n&&e?void t.resolve(e.data):(t.reject(e,n,r),!0)}),t.promise()},o=function(e,t,n){var r=jQuery.Deferred(),a={entity:t,filesystem_credentials:n};return UpdraftCentral.send_site_rpc("core.validate_credentials",a,e,function(e,t,n){"ok"!==t||e.data.error?r.reject(e,t,n):r.resolve(e.data)}),r.promise()}}function UpdraftCentral_Site(e){var t=this;this.id,this.site_description,this.site_url,this.site_hash,this.site_row=e,this.save_credentials_in_browser,this.site_credentials,this.credentials_required,this.automatic_backups,this.autobackup_options,this.autobackup_requested,this.autobackup_complete,this.updates,this.update_requests,this.update_processing,this.additional_options,this.mass_update;var n=function(){t.id=t.site_row.data("site_id"),t.site_description=t.site_row.data("site_description"),t.site_url=t.site_row.data("site_url"),t.site_hash=UpdraftCentral_Library.md5(t.id+"_"+t.site_row.data("site_url")),t.save_credentials_in_browser=!1,t.site_credentials=!1,t.credentials_required=!1,t.automatic_backups=!1,t.autobackup_options={},t.autobackup_requested=!1,t.autobackup_complete=!1,t.backup_completed=!1,t.updates={plugin:new UpdraftCentral_Collection,theme:new UpdraftCentral_Collection,core:new UpdraftCentral_Collection},t.update_requests=new UpdraftCentral_Queue,t.update_processing=!1,t.mass_update=!1};n(),this.get_update_info=function(e,n){return!!t.updates[e].exists(n)&&t.updates[e].item(n)}}function UpdraftCentral_Queueable_Modal(e){var t,n,r=!1,a=e||jQuery("#updraftcentral_modal_dialog"),o=function(){"undefined"!=typeof a?a.on(t,function(){if(n.is_empty())r=!0,a.off(t),n.unlock();else{var e=n.dequeue();"undefined"!=typeof e&&s(e)}}):console.log("UpdraftCentral_Queueable_Modal: Modal element does not exist.")},i=function(){n=new UpdraftCentral_Queue,t="hidden.bs.modal",o()};i();var s=function(e){UpdraftCentral.open_modal(e.title,e.body,e.action_button_callback,e.action_button_text,e.pre_open_callback,e.sanitize_body,e.extra_classes)};this.load=function(){if(!n.is_empty()&&n.get_lock()){var e=n.dequeue();"undefined"!=typeof e&&s(e)}},this.open=function(e,t){"undefined"!=typeof t&&t?n.is_locked()||(n.enqueue(e),!n.is_empty()&&r&&(o(),r=!1)):s(e)},this.close=function(){UpdraftCentral.close_modal()},this.get_queue_item_count=function(){return n.get_length()}}function UpdraftCentral_Library(){this.dialog={};var e=jQuery,t=function(){e.fullscreen.isFullScreen()&&e(".bootbox.modal").prependTo("#updraftcentral_dashboard"),e(".bootbox.modal").on("click","a",function(t){var n=e(this).attr("href");redirect_updraft_website_links(n,t)}),e(".bootbox.modal .updraftcentral_site_editdescription").click(function(t){t.preventDefault(),e(this).closest(".modal").modal("hide"),open_site_configuration(UpdraftCentral.$site_row)}),e(".bootbox.modal .updraftcentral_test_other_connection_methods").click(function(t){t.preventDefault(),e(this).closest(".modal").modal("hide"),open_connection_test(UpdraftCentral.$site_row)})};this.ucfirst=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},this.open_connection_test=function(t){var n=UpdraftCentral.get_contact_url(t),r=t.data("site_id"),a=t.data("connection_method");if("via_mothership_encrypting"==a)return void UpdraftCentral_Library.dialog.alert("<h2>"+udclion.test_connection_methods+"</h2><p>"+udclion.test_not_possible_in_current_mode+"</p>");var o="direct_jquery_auth"==a||"direct_default_auth"==a||"direct_default_auth"==a?"direct":a;UpdraftCentral.open_modal(udclion.test_connection_methods,UpdraftCentral.template_replace("sites-connection-test",{site_url:n}),!0,!1,function(){var i=!0;"https:"==document.location.protocol&&"http:"==n.substring(0,5).toLowerCase()&&(i=!1),i?(e("#updraftcentral_modal .connection-test-direct .connection-test-result").html(""),UpdraftCentral.send_ajax("ping",null,t,"direct_default_auth","#updraftcentral_modal .connection-test-direct .connection-test-result",function(t,n,a){if(UpdraftCentral.get_debug_level()>0&&(console.log("Result follows for 'direct_default_auth' method:"),console.log(t)),"ok"==n){var i='<span class="connection-test-succeeded">'+udclion.succeeded+"</span> ";i+="direct"==o?udclion.current_method+" "+udclion.best_method+" "+udclion.recommend_keep:udclion.best_method+" "+udclion.recommend_use+' <a href="#" class="connection-test-switch" data-site_id="'+r+'" data-connection_method="direct_default_auth">'+udclion.switch_to+"...</a>",e("#updraftcentral_modal .connection-test-direct .connection-test-result").html(i)}else e("#updraftcentral_modal .connection-test-direct .connection-test-result").html('<span class="connection-test-failed">'+udclion.failed+" ("+a+")</span>")},30,!1)):e("#updraftcentral_modal .connection-test-direct .connection-test-result").html(udclion.not_possible_browser_restrictions),e("#updraftcentral_modal .connection-test-via_mothership .connection-test-result").html(""),UpdraftCentral.send_ajax("ping",null,t,"via_mothership","#updraftcentral_modal .connection-test-via_mothership .connection-test-result",function(t,n,o){if(e("#updraftcentral_modal .connection-test-via_mothership .connection-test-result").html(n),UpdraftCentral.get_debug_level()>0&&(console.log("Result follows for 'via_mothership' method:"),console.log(t)),"ok"==n){var i='<span class="connection-test-succeeded">'+udclion.succeeded+"</span> ";i+="via_mothership"!=a?'<a href="#" class="connection-test-switch" data-site_id="'+r+'" data-connection_method="via_mothership">'+udclion.switch_to+"...</a>":udclion.current_method,e("#updraftcentral_modal .connection-test-via_mothership .connection-test-result").html(i)}else{var s=o;"unexpected_http_code"==o&&(null!=t&&t.hasOwnProperty("data")&&null!=t.data&&t.data.hasOwnProperty("response")&&t.data.response.hasOwnProperty("code")&&(s+=" - "+t.data.response.code),null!=t&&t.hasOwnProperty("data")&&null!=t.data&&t.data.hasOwnProperty("response")&&t.data.response.hasOwnProperty("message")&&(s+=" - "+t.data.response.message)),e("#updraftcentral_modal .connection-test-via_mothership .connection-test-result").html('<span class="connection-test-failed">'+udclion.failed+" ("+s+")</span>")}},30,!1),e("#updraftcentral_modal .connection-test-via_mothership_encrypting .connection-test-result").html(""),UpdraftCentral.send_ajax("ping",null,t,"via_mothership_encrypting","#updraftcentral_modal .connection-test-via_mothership_encrypting .connection-test-result",function(t,n,o){if(UpdraftCentral.get_debug_level()>0&&(console.log("Result follows for 'via_mothership_encrypting' method:"),console.log(t)),"ok"==n){var i='<span class="connection-test-succeeded">'+udclion.succeeded+"</span> ";i+="via_mothership_encrypting"!=a?'<a href="#" class="connection-test-switch" data-site_id="'+r+'" data-connection_method="via_mothership_encrypting">'+udclion.switch_to+"...</a>":udclion.current_method,e("#updraftcentral_modal .connection-test-via_mothership_encrypting .connection-test-result").html(i)}else{var s=o;"unexpected_http_code"==o&&(null!=t&&t.hasOwnProperty("data")&&null!=t.data&&t.data.hasOwnProperty("response")&&t.data.response.hasOwnProperty("code")&&(s+=" - "+t.data.response.code),null!=t&&t.hasOwnProperty("data")&&null!=t.data&&t.data.hasOwnProperty("response")&&t.data.response.hasOwnProperty("message")&&(s+=" - "+t.data.response.message)),e("#updraftcentral_modal .connection-test-via_mothership_encrypting .connection-test-result").html('<span class="connection-test-failed">'+udclion.failed+" ("+s+")</span>")}},30,!1)},!0,"modal-lg")},this.dialog.alert=function(e,n,r){r="undefined"==r||r,r&&(e=this.sanitize_html(e)),bootbox.alert(e,n),t()},this.dialog.confirm=function(e,n){bootbox.confirm(e,n),t()},this.dialog.prompt=function(e,n,r){bootbox.prompt({title:e,value:n,callback:r}),t()},this.base64_encode=function(e){return forge.util.encode64(e)},this.md5=function(e){var t=forge.md.md5.create();return t.update(e),t.digest().toHex()},this.sanitize_html=function(e){var t=function(e){if(/^https?:\/\//.test(e))return e},n=function(e){return e};return html_sanitize.sanitize(e,t,n)},this.quote_attribute=function(e,t){return t=t?"&#13;":"\n",(""+e).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,t).replace(/[\r\n]/g,t)},this.open_browser_at=function(e,t,n){t="undefined"!=typeof t?t:null,n="undefined"==typeof n?e:n,UpdraftCentral.send_site_rpc("core.get_login_url",t,e,function(e,t,n){if("ok"==t&&!1!==e&&e.hasOwnProperty("data")){var r=e.data.login_url,a=window.open(r,"_blank");UpdraftCentral_Library.focus_window_or_error(a)}},n)},this.focus_window_or_error=function(e){"undefined"!=typeof e&&null!==e?e.focus():this.dialog.alert("<h2>"+udclion.open_new_window+"</h2>"+udclion.window_may_be_blocked)},this.toggle_fullscreen=function(){e.fullscreen.isFullScreen()?(e("footer").show(),e.fullscreen.exit(),e("#updraftcentral_modal_dialog").appendTo(document.body)):(e("footer").hide(),e("#updraftcentral_dashboard").fullscreen({overflow:"scroll",toggleClass:"updraft-fullscreen"}),e("#updraftcentral_modal_dialog").appendTo("#updraftcentral_dashboard"))},this.unserialize=function(e){for(var t,n,r=decodeURI(e),a=r.split("&"),o={},i=0,s=a.length;i<s;i++)t=a[i].split("="),n=t[0],void 0===o[n]?o[n]=unescape(t[1]):("string"==typeof o[n]&&(o[n]=[o[n]]),o[n].push(unescape(t[1])));return o},this.get_serialized_options=function(t){var n=e(t).serialize();return e.each(e(t+" input[type=checkbox]").filter(function(t){return 0==e(this).prop("checked")}),function(t,r){var a="0";n+="&"+e(r).attr("name")+"="+a}),n},this.download_inner_html=function(e,t,n){n=n||"text/plain";var r=document.getElementById(t).innerHTML,a=document.body.appendChild(document.createElement("a"));a.setAttribute("download",e),a.setAttribute("style","display:none;"),a.setAttribute("href","data:"+n+";charset=utf-8,"+encodeURIComponent(r)),a.click()}}jQuery(document).ready(function(e){UpdraftCentral_Library=new UpdraftCentral_Library});